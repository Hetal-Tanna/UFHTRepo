<apex:page controller="ViewDataController" readOnly="true" extensions="DataProviderForViewData"
    docType="html-5.0" sidebar="false" id="viewFH"
    tabStyle="View_Field_History__tab">
    
    <!-- Scripts for Export CSV -->
    <apex:includeScript value="{!$Resource.csvalasql}" />
    <apex:includeScript value="{!$Resource.csvcore}" />
    <apex:includeScript value="{!$Resource.csvjs}" />
    <!-- End of Script for Export CSV -->
    <!-- Scripts for Export pdf-->
    <apex:includeScript value="{!$Resource.pdfmakedup}" />
    <apex:includeScript value="{!$Resource.vfs_fonts}" />
     <script type="text/javascript" src="/js/functions.js"></script>
    <!-- End of Script for Export pdf-->
    <script src="/soap/ajax/28.0/connection.js" type="text/javascript"></script>
    <script src="/soap/ajax/37.0/apex.js" type="text/javascript"></script>
    <script src="https://code.jquery.com/jquery-1.10.2.js"></script>
    <script src="https://code.jquery.com/ui/1.9.0/jquery-ui.js"></script>
    <script
        src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.1/jquery-ui.js"></script>
     <script
        src="{!URLFOR($Resource.BootStrap, '/bootstrapNew/js/bootstrap.min.js')}"></script>
    <script
        src=" https://ajax.googleapis.com/ajax/libs/jqueryui/1.10.1/jquery-ui.min.js"></script>
    <link rel="stylesheet"
        href="https://code.jquery.com/ui/1.9.1/themes/base/jquery-ui.css" />
    <link
        href="{!URLFOR($Resource.BootStrap, '/bootstrapNew/css/bootstrap.min.css')}"
        rel="stylesheet" />
    <link
        href="{!URLFOR($Resource.BootStrap, '/bootstrapNew/css/landing-page1.css')}"
        rel="stylesheet" />
    <link
        href="{!URLFOR($Resource.BootStrap, '/bootstrapNew/css/bootstrap-datepicker.css')}"
        rel="stylesheet" />
    <link
        href="{!URLFOR($Resource.BootStrap, '/bootstrapNew/css/bootstrap-datepicker.min.css')}"
        rel="stylesheet" />
    <link
        href="{!URLFOR($Resource.BootStrap, '/bootstrapNew/css/jquery.steps.css')}"
        rel="stylesheet" />
    <link
        href="{!URLFOR($Resource.BootStrap, '/bootstrapNew/font-awesome/css/font-awesome.min.css')}"
        rel="stylesheet" type="text/css" />
   
    <script
        src="{!URLFOR($Resource.BootStrap, '/bootstrapNew/js/bootstrap-datepicker.min.js')}"></script>
    <script
        src="{!URLFOR($Resource.BootStrap, '/bootstrapNew/js/jquery.steps.js')}"></script>
    <!-- <script
        src="{!URLFOR($Resource.BootStrap, '/bootstrapNew/js/jquery.validate.js')}"></script> -->
    <apex:stylesheet value="//cdnjs.cloudflare.com/ajax/libs/semantic-ui/2.1.8/semantic.css" />
    <link rel="stylesheet"
        href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" />
    <apex:includeScript value="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js" />
    <apex:includeScript value="https://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular-sanitize.js" />
    <apex:includeScript value="{!$Resource.ViewDataScript}" />
    <apex:stylesheet value="{!$Resource.ViewDataStyle}"/>
    <apex:stylesheet value="{!URLFOR($Resource.Ultra_Css)}"></apex:stylesheet>
    <style>
        .uibutton.pdf span {
            background-image:
                url("{!URLFOR($Resource.UltraFHT_Buttons, 'UltraFHt_Buttons/blue/pdf_blue.png')}");
            margin-left: -3px;
        }
        
        .uibutton.excel span {
            background-image:
                url("{!URLFOR($Resource.UltraFHT_Buttons, 'UltraFHt_Buttons/blue/excel_blue.png')}");
            margin-left: -3px;
        }
    </style>
    <apex:form id="frm">
        <div class="bs PageSizeDiv"
            style="background-color: #f8f8f8; margin-top: -65px;">
            <div class="content-section-a" style="background-color: #f8f8f8;">
                <div class="content"
                    style="margin-top: -10px !important; padding: 0px 40px 30px 30px;">
                    <div id="displayHistoryRecord" ng-app="myApp"
                        ng-controller="fetchDataController">
                        <div>
                            <div>
                             <apex:image value="{!$Resource.HistoricalDataImage}"
                                    width="50px" style="margin:10px 0" />
                            <img id="preview" style="display:none;" src ="{!$Resource.EternusLogo}"/>
                             <canvas id="myCanvas"  style="display:none;"/>
                                <apex:outputLabel value="View Historical Data"
                                    style="font-weight: 600;font-size:30px !important; margin-top:6px; font-family:pageheader;" />
                            </div>
                            <div ng-show="filteredHistoryData.length > 0" class="ng-hide"
                                style="float: right;  margin-top: -50px;">
                                <apex:outputPanel id="downloadLinks">
                                    <apex:outputPanel >
                                        <div class="btn-group">
                                            <button type="button"
                                                class="btn btn-default uibutton excel imagefix"
                                                title="{!$Label.VD_Export_Titile}"
                                                style="margin-right: 10px; background: #167490 !important; width: 38px;"
                                                ng-click="exportData()">
                                                <span></span>
                                            </button>
                                            <button type="button"
                                                class="btn btn-default uibutton pdf imagefix"
                                                title="{!$Label.VD_ExportPdfTitile}"
                                                style="background: #167490 !important; width: 38px;"
                                                ng-click="downloadPdf()">
                                                <span></span>
                                            </button>
                                        </div>
                                    </apex:outputPanel>
                                </apex:outputPanel>
                            </div>

                        </div>
                        
                        <div ng-show="getShowMoreData();" class="ng-hide" style="margin-bottom: 20px;font-family: pageheader;font-weight: bold;">
                                    {!$Label.ViewData_Note}
                        </div>
                        <div id="dialog" title="Confirmation" style="padding-bottom: 0px;">
                            <div class="DialogPanelClass">
                            <apex:outputPanel id="dialogP">
                            <div class="bs">
                            <div class="row" style="margin-top:9px">
                                 <label class="asterix" style="font-family: pageheader;margin-left: 15px;font-size: 14px;">{!$Label.VD_ViewMoreDataMessage}</label>
                            </div>
                               <table>  
                                  <tr><td style="float: center;margin-right: 25px;margin-top: 10px;">
                                      <div class="final-btns" style="margin-top: 11px;">
                                      <apex:commandButton value="Ok" html-ng-click="loadMoreDataForAnObject();" title="Confirm"
                                      styleClass="btn btn-sm btn-primary" onclick="closeDialog();"
                                       style="font-family: pageheader !important;font-weight: bold;background-color: #2190b1 !important;text-shadow: 1px 1px 0px rgba(0,0,0,0.4) !important;margin-right: 10px !important;border-radius: 0px !important;color: white !important;border: 0px;font-size: 15px;padding: 2px 18px;"/>
                                      <apex:commandButton value="Cancel" 
                                                          onClick="closeDialog();" title="Cancel"
                                                          styleclass="btn btn-sm btn-default"
                                                          style="font-family: pageheader !important;font-size: 16px;border: none;padding: 0px 10px;font-weight: bold;"/>
                                      </div>
                                  </td> </tr>  
                             </table>
                             </div>
                            </apex:outputPanel>  
                            </div>
                        </div>
                        <div class="loaderMain  ng-hide" id="assign-action-spinner-main"
                            ng-show="showLoader">
                            <div id="assign-action-spinner-content">
                                <img src="{!$Resource.Spinner_Image}"
                                    alt="{!$Label.VD_Processing}" title="{!$Label.VD_Processing}" />
                                <p style="padding-left:2px;">{!$Label.VD_Processing}</p>
                            </div>
                        </div>
                        <div class="panel ng-cloak" style="margin-top: -13px;">
                            <div class="panel-heading">
                                <div class="row" style="margin-top: -9px;">
                                    <div class="col-lg-3 col-md-3 col-sm-3">
                                        <div class="form-group small">
                                            <label class="asterix">{!$Label.VD_Choose_An_Object}</label>
                                            <apex:selectList value="{!selectedObject}"
                                                multiselect="false" size="1" title="Choose an Object"
                                                styleClass="form-control required object"
                                                onChange="getHistoryRecordsForObject();">
                                                <apex:selectOptions value="{!objectSelectedoptionsList}" />
                                            </apex:selectList>
                                        </div>
                                    </div>
                                    <div class="col-lg-3 col-md-3 col-sm-3">
                                        <div class="form-group small">
                                            <apeX:outputPanel id="DateFilter">
                                                <label class="asterix">{!$Label.VD_Date_Range}</label>
                                                <apex:selectList value="{!selectedDateFilter}"
                                                    multiselect="false" size="1" title="Date Range"
                                                    onchange="DateFileter()"
                                                    styleClass="form-control dateRange">
                                                    <apex:selectOptions value="{!dateFilterSelectOptionsList}" />
                                                </apex:selectList>
                                            </apeX:outputPanel>
                                        </div>

                                    </div>

                                    <div class="col-lg-1 col-md-1 col-sm-1 NumberOfDay"
                                        style="width: 83px;">
                                        <div class="form-group small" style="width: 34px;">
                                            <apex:outputPanel >
                                                <label class="asterix">{!$Label.VD_Days}</label>
                                                <apex:inputText value="{!lastNumberOfDays}" maxlength="3"
                                                    title="Last Number of Days"
                                                    styleClass="form-control TxtDays"
                                                    onkeypress="if(event.which < 48 || event.which > 57) return false;"
                                                    onKeyUp="typewatch(function(){checkDayValue()}, 1000 );">
                                                </apex:inputText>
                                            </apex:outputPanel>
                                            <div style="width: 80px !important;margin-left: -10px;">
                                                <p id="DayError" class="error-field"></p>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="FromToDate">
                                    <apex:outputPanel id="CustomDate">
                                        <apex:outputPanel >
                                            <div class="col-lg-1 col-md-1 col-sm-1" style="margin-left:-20px;">
                                                <div class="form-group small calendar"
                                                    id="sandbox-container">
                                                    <label class="asterix">{!$Label.VD_From}</label>
                                                    <div class="input-group date">
                                                        <apex:inputField value="{!startDateObj.DateHolder__c}"
                                                            styleClass="form-control required startDate"
                                                            onchange="validateDate(true);"
                                                            html-placeholder="mm/dd/yyyy" id="startDate"
                                                            style="width: 79px; z-index: 0;">
                                                        </apex:inputField>
                                                    </div>
                                                    <div>
                                                        <p id="dateErrorMessageStartDateDiv" class="error-field" style="width: 101px;"></p>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-lg-1 col-md-1 col-sm-1 col-xs-6">
                                                <div class="form-group small calendar"
                                                    id="sandbox-container">
                                                    <label class="asterix">{!$Label.VD_To}</label>
                                                    <div class="input-group date">
                                                        <apex:inputField value="{!endDateObj.DateHolder__c}"
                                                            styleClass="form-control required endDate"
                                                            onchange="validateDate(true);"
                                                            html-placeholder="mm/dd/yyyy" id="endDate"
                                                            style="width: 79px; z-index: 0;" />
                                                    </div>
                                                    <div>
                                                        <p id="dateErrorMessageEndDateDiv" class="error-field" style="width: 101px;"></p>
                                                    </div>
                                                </div>

                                            </div>

                                        </apex:outputPanel>
                                    </apex:outputPanel>
                                    </div>
                                    <div ng-show="getShowMoreData();"  class="col-lg-3 col-md-3 col-sm-3 ng-hide" style="margin-top: 10px;">
                                                <button type="button" 
                                                                    Class="btn btn-sm btn-small showMoreButton"
                                                                    title="View More Data" style="background: #167490 !important; color: white;"
                                                                    onclick = "showPopup();"
                                                 >
                                                {!$Label.VD_ShowMoreDataButtonLabel}
                                                </button>
                                    </div>
                                    <apex:outputPanel id="clearFilters">
                                        <!--                                       <div class="clearFilters"> -->
                                        <div ng-show="checkIfFiltersAppliedOrNot();" class="ng-cloak">
                                            <button id="clearAllFilters" type="button"
                                                class="btn btn-default uibutton imagefix"
                                                title="Clear Filters"
                                                ng-click="clearFilter('clearAllFilter');"
                                                style="width: 40px; height: 25px; background: #1fa5cd !important; border: none !important; margin-top : 15px; float: right;">
                                               <!-- <img class="clear" src='{!URLFOR($Resource.Clear_Filter)}'
                                                    style="width: 25px !important; height: 25px !important;" /> -->
                                                <img class="clear" src='{!URLFOR($Resource.CrossImage)}' style="width: 26px !important;margin-top: 7px;height: 23px !important;"/>
                                            </button>
                                        </div>
                                    </apex:outputPanel>

                                </div>
                            </div>
                        </div>

                        <div class="mCustomScrollbar" data-mcs-theme="dark">
                            <div id="historyRecordDiv" class="panel-body"
                                style="font-size: small; margin-top: -21px; margin-left: 1px;margin-right: 1px;">
                                <div ng-show="fetchedHistoryData.length > 0" class="ng-cloak">
                                    <table id="table1" class="object-grid scrollTable"
                                        style="margin-top: -10px; table-layout: fixed;">
                                        <thead>
                                            <tr>
                                                <th style="width: 20% !important;">{!$Label.VD_RecordName}
                                                    <div style="display: inline-block;">
                                                        <i id="recordName" class="sort icon pull-right"
                                                            style="cursor: pointer" ng-click="sort('recordName')" />

                                                        <div class="dropdown cart pull-right"
                                                            style="height: 15px;">
                                                           
                                                           
                                                           <img src="{!URLFOR($Resource.AppliedFilterIcon)}" ng-show="displayAppliedFilterIconRecordName" width="9" height="8" style="margin-top: 6px;margin-right: -8px;"/> 
                                                            <i class="filter icon dropdown-toggle"
                                                                data-toggle="dropdown" style="cursor: pointer;" ng-show="displayAppliedFilterIconRecordName"/>
                                                                
                                                            <i class="filter icon dropdown-toggle"
                                                                data-toggle="dropdown" style="cursor: pointer;" ng-show="!displayAppliedFilterIconRecordName"/> 

                                                            <ul class="dropdown-menu">
                                                                <span
                                                                    ng-repeat="x in fetchedHistoryData | orderBy:'recordName' | unique: 'recordName'">
                                                                    <label onclick="preventPropagation(true);" style="height: 17px !important;"
                                                                        ondblclick="preventPropagation(true);"><input type="checkbox"
                                                                        ng-model="myRecordFilter.selected[getHtml(x.recordName)]"
                                                                        onclick="preventPropagation(true);"
                                                                        ondblclick="preventPropagation(true);"
                                                                        ng-true-value="'{{getHtml(x.recordName);}}'"
                                                                        ng-false-value="''"
                                                                        style="-webkit-transform: scale(0.8);">{{x.recordName}}</input></label><br />
                                                                </span>
                                                                <div class="ui divider" style="margin: 5px 9px 5px 9px;"></div>
                                                                <li><span
                                                                    class="submitRecordfilter clearFilterText btn btn-primary"
                                                                    id="records"
                                                                    style="font-family: pageheader !important;font-size: 16px;font-weight: bold;margin-left: 25px; background-color: #1797c0 !important; background: none; padding: 5px; border-radius: 0px; margin-right: 8px;"
                                                                    ng-click="applyFilters();loseFocus();">{!$Label.VD_Ok}</span> 
                                                                    <span id="clearAllRecordFilter" style="margin-right: 15px;"
                                                                    ng-click="clearFilter('recordName');"> <!--                                               <img class="clearFilterImage" -->
                                                                        <span class="clearFilterText btn btn-default"
                                                                        style="color: #666666 !important;border: none;line-height: 8px !important;padding: 5px; border-radius: 0px;font-family: pageheader !important;font-size: 16px;font-weight: bold;">{!$Label.VD_Clear_Filter}</span>
                                                                </span></li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </th>
                                                <th style="width: 12% !important;">{!$Label.VD_Modified_Time}
                                                    <div style="display: inline-block;">
                                                        <i id="modifiedTime" class="sort icon pull-right"
                                                            style="cursor: pointer" ng-click="sort('modifiedTime')" />
                                                    </div>
                                                </th>
                                                <th style="display: none !important;"
                                                    ng-click="sort('modifiedDisplayTime')">modifiedDisplayTime
                                                    <span class="glyphicon sort-icon"
                                                    ng-show="sortKey=='modifiedOn'"></span>
                                                </th>
                                                <th style="width: 12% !important;">{!$Label.VD_Modified_By}
                                                    <div style="display: inline-block;">
                                                        <i id="userLabel" class="sort icon pull-right"
                                                            style="cursor: pointer" ng-click="sort('modifiedBy')" />

                                                        <div class="dropdown cart pull-right"
                                                            style="height: 15px;">
                                                               
                                                                <img src="{!URLFOR($Resource.AppliedFilterIcon)}" ng-show="displayAppliedFilterIconUserName" width="9" height="8" style="margin-top: 6px;margin-right: -8px;"/> 
                                                               
                                                               <i class="filter icon dropdown-toggle"
                                                                data-toggle="dropdown" style="cursor: pointer;" ng-show="displayAppliedFilterIconUserName"/>
                                                                
                                                                <i class="filter icon dropdown-toggle"
                                                                data-toggle="dropdown" style="cursor: pointer" ng-show="!displayAppliedFilterIconUserName"/>
                                                            
                                                            <ul class="dropdown-menu" style="padding-top: 0px;">
                                                                <span
                                                                    ng-repeat="x in fetchedHistoryData | orderBy:'modifiedByName' | unique: 'modifiedByName'">
                                                                    <label onclick="preventPropagation(true);" style="height: 17px !important;"
                                                                        ondblclick="preventPropagation(true);"><input type="checkbox"
                                                                        ng-model="myUserFilter.selected[getHtml(x.modifiedByName)]"
                                                                        onclick="preventPropagation(true);"
                                                                        ondblclick="preventPropagation(true);"
                                                                        ng-true-value="'{{getHtml(x.modifiedByName);}}'"
                                                                        ng-false-value="''"
                                                                        style="-webkit-transform: scale(0.8);">{{x.modifiedByName}}</input></label><br />
                                                                </span>
                                                                <div class="ui divider" style="margin: 5px 9px 5px 9px;"></div>
                                                                <li><span
                                                                    class="submitRecordfilter clearFilterText btn btn-primary"
                                                                    id="records"
                                                                    style="margin-left: 25px; background-color: #1797c0 !important; background: none; padding: 5px; border-radius: 0px; margin-right: 8px;font-family: pageheader !important;font-size: 16px;font-weight: bold;"
                                                                    ng-click="applyFilters();loseFocus();">{!$Label.VD_Ok}</span> <span
                                                                    id="clearAllRecordFilter" style="margin-right: 15px;"
                                                                    ng-click="clearFilter('userName');"> <!--                                                   <img class="clearFilterImage" -->
                                                                        <span class="clearFilterText btn btn-default"
                                                                        style="color: #666666 !important;border: none;line-height: 8px !important;padding: 5px; border-radius: 0px;font-family: pageheader !important;font-size: 16px;font-weight: bold;">{!$Label.VD_Clear_Filter}</span>
                                                                </span></li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </th>
                                                <th style="width: 15% !important;">{!$Label.VD_Modified_Field}
                                                    <div style="display: inline-block;">
                                                        <i id="field" class="sort icon pull-right"
                                                            style="cursor: pointer" ng-click="sort('fieldLabel')" />

                                                        <div class="dropdown cart pull-right"
                                                            style="height: 15px;">
                                                             
                                                            <img src="{!URLFOR($Resource.AppliedFilterIcon)}" ng-show="displayAppliedFilterIconFieldName" width="9" height="8" style="margin-top: 6px;margin-right: -8px;"/> 
                                                            
                                                            <i class="filter icon dropdown-toggle"
                                                                data-toggle="dropdown" style="cursor: pointer;" ng-show="displayAppliedFilterIconFieldName"/>
                                                            <i class="filter icon dropdown-toggle"
                                                                data-toggle="dropdown" style="cursor: pointer;" ng-show="!displayAppliedFilterIconFieldName"/>
                                                                
                                                            <ul class="dropdown-menu">
                                                                <span
                                                                    ng-repeat="x in fetchedHistoryData | orderBy:'fieldLabel' | unique: 'fieldLabel'"
                                                                    > <label onclick="preventPropagation(true);"
                                                                        ondblclick="preventPropagation(true);" style="height: 17px !important;"><input
                                                                        type="checkbox"
                                                                        ng-model="myFieldFilter.selected[x.fieldName]"
                                                                        onclick="preventPropagation(true);"
                                                                        ondblclick="preventPropagation(true);"
                                                                        ng-true-value="'{{x.fieldName}}'" ng-false-value="''"
                                                                        style="-webkit-transform: scale(0.8);">{{x.fieldLabel}}</input></label><br />
                                                                </span>
                                                                <div class="ui divider" style="margin: 5px 9px 5px 9px;"></div>
                                                                 <li><span
                                                                    class="submitRecordfilter clearFilterText btn btn-primary"
                                                                    id="records"
                                                                    style="font-family: pageheader !important;font-size: 16px;font-weight: bold;margin-left: 25px; background-color: #1797c0 !important; background: none; padding: 5px; border-radius: 0px; margin-right: 8px;"
                                                                    ng-click="applyFilters();loseFocus();">{!$Label.VD_Ok}</span> <span
                                                                    id="clearAllRecordFilter" style="margin-right: 15px;"
                                                                    ng-click="clearFilter('fieldName');"> <!--                                                   <img class="clearFilterImage" -->
                                                                        <span class="clearFilterText btn btn-default"
                                                                        style="color: #666666 !important;border: none;font-family: pageheader !important;line-height: 8px !important;font-size: 16px;font-weight: bold;padding: 5px; border-radius: 0px;">{!$Label.VD_Clear_Filter}</span>
                                                                </span></li>
                                                            </ul>
                                                        </div>
                                                    </div>
                                                </th>
                                                <th style="width: 20% !important;">{!$Label.VD_Old_Value}
                                                    <div style="display: inline-block;">
                                                        <i id="oldValue" class="sort icon pull-right"
                                                            style="cursor: pointer" ng-click="sort('oldValue')" />
                                                    </div>
                                                </th>
                                                <th style="width: 21% !important;">{!$Label.VD_New_Value}
                                                    <div style="display: inline-block;">
                                                        <i id="newValue" class="sort icon pull-right"
                                                            style="cursor: pointer" ng-click="sort('newValue')" />
                                                    </div>
                                                </th>
                                            </tr>
                                        </thead>
                                        <tbody style="font-weight: 100;" class="hidden-element"
                                            ng-show="filteredHistoryData.length > 0">
                                            <tr
                                                data-ng-repeat="x in filteredHistoryData | orderBy:sortKey:reverse | firstPage:currentPage*pageSize | limitTo:pageSize track by $index">
                                                <td style="width: 20% !important; word-wrap: break-all;" ><a
                                                    href="/{{x.parentId}}" target="_blank">{{x.recordName}}</a></td>
                                                <td style="display: none !important;" class="hidden-element">{{x.modifiedTime}}</td>
                                                <td style="width: 12% !important; word-wrap: break-all;" >{{x.modifiedDisplayTime}}</td>
                                                <td
                                                    style="width: 12% !important; padding-left: 5px; word-break: break-all;" ><a
                                                    href="/{{x.modifiedById}}" target="_blank">{{x.modifiedByName}}</a></td>
                                                <td
                                                    style="width: 15% !important; padding-left: 7px; word-break: break-all;" >{{x.fieldLabel}}</td>
                                                <td
                                                    style="width: 20% !important; padding-left: 11px; word-break: break-all;"
                                                    id="td1" ng-bind-html="x.oldValue" ></td>
                                                <td
                                                    style="width: 21% !important; padding-left: 15px; word-break: break-all;"
                                                    id="td2" ng-bind-html="x.newValue" ></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                    <div class="pagination hidden-element"
                                        ng-show="filteredHistoryData.length > 0"
                                        style="border-top: 0px; padding-top: 1px; border-bottom: 2px solid #f2f2f2 !important; margin-bottom: 5px; margin-top: 5px;">
                                        <div class="page-counter" style="font-weight: bold;">
                                            {!$Label.VD_Showing} {{((currentPage*pageSize)+1)}} {!$Label.VD_Hyphen}<span
                                                ng-if="(pageSize*(currentPage+1))<=filteredHistoryData.length">{{(pageSize*(currentPage+1))}}
                                            </span> <span
                                                ng-if="(pageSize*(currentPage+1))>filteredHistoryData.length">{{filteredHistoryData.length}}
                                            </span>{!$Label.VD_Of} {{filteredHistoryData.length}} {!$Label.VD_Records}
                                        </div>
                                        <div class="page-actions">
                                            <apex:outputPanel id="navigateButtons">
                                                <apex:commandButton title="First"
                                                    image="{!URLFOR($Resource.BootStrap,'/bootstrapNew/images/First-arrow.png')}"
                                                    styleclass="first-btn btn btn-default" reRender="renderHyperLink"
                                                    style="background-color:#fff !important; border: none; vertical-align: bottom;"
                                                    html-ng-disabled="currentPage == 0"
                                                    html-ng-click="paginationForAllButton(currentPage=0);" status="actStatusId" />
                                                <apex:commandButton title="Previous"
                                                    image="{!URLFOR($Resource.BootStrap,'/bootstrapNew/images/previous-arrow.png')}"
                                                    styleclass="previous-btn btn btn-default" reRender="renderHyperLink"
                                                    style="background-color:#fff !important;border: none; vertical-align: bottom;"
                                                    html-ng-disabled="currentPage == 0"
                                                    html-ng-click="paginationForAllButton(currentPage-1);"
                                                    status="actStatusId" />
                                                <apex:commandButton title="Next"
                                                    image="{!URLFOR($Resource.BootStrap,'/bootstrapNew/images/next-arrow.png')}"
                                                    styleclass="next-btn btn btn-default" reRender="renderHyperLink"
                                                    style="background-color:#fff !important;border: none; vertical-align: bottom;"
                                                    html-ng-disabled="currentPage >= filteredHistoryData.length/pageSize - 1"
                                                    html-ng-click="paginationForAllButton(currentPage+1);"
                                                    status="actStatusId" />
                                                <apex:commandButton title="Last"
                                                    image="{!URLFOR($Resource.BootStrap,'/bootstrapNew/images/latest-arrow.png')}"
                                                    styleclass="last-btn btn btn-default" reRender="renderHyperLink"
                                                    style="background-color:#fff !important;border: none; vertical-align: bottom;"
                                                    html-ng-disabled="currentPage >= filteredHistoryData.length/pageSize - 1"
                                                    html-ng-click="paginationForAllButton(noOfPages - 1);"
                                                    status="actStatusId" />
                                            </apex:outputPanel>
                                        </div>
                                    </div>
                                    <div class="message infoM3 hidden-element" role="alert"
                                        ng-show="filteredHistoryData.length == 0 && fetchedHistoryData.length > 0 && !noSelectedObject">
                                        <table border="0" cellpadding="0" cellspacing="0"
                                            class="messageTable" style="padding: 0px; margin: 0px;">
                                            <tbody>
                                                <tr valign="top">
                                                    <td><img alt="info" class="msgIcon" src="/s.gif"
                                                        title="info" /></td>
                                                    <td class="messageCell"><div class="messageText">
                                                            <span><h4></h4>
                                                            </span>{!$Label.Information_Message_For_Filters }<br />
                                                        </div></td>
                                                </tr>
                                                <tr>
                                                    <td></td>
                                                    <td></td>
                                                </tr>
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                                <div class="message infoM3 hidden-element" role="alert"
                                    ng-show="fetchedHistoryData.length == 0 && !noSelectedObject">
                                    <table border="0" cellpadding="0" cellspacing="0"
                                        class="messageTable" style="padding: 0px; margin: 0px;">
                                        <tbody>
                                            <tr valign="top">
                                                <td><img alt="info" class="msgIcon" src="/s.gif"
                                                    title="info" /></td>
                                                <td class="messageCell"><div class="messageText">
                                                        <span><h4></h4>
                                                        </span>{!$Label.Information_Message }<br />
                                                    </div></td>
                                            </tr>
                                            <tr>
                                                <td></td>
                                                <td></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                                <div class="message infoM3 hidden-element" role="alert"
                                    ng-show="noSelectedObject">
                                    <table border="0" cellpadding="0" cellspacing="0"
                                        class="messageTable" style="padding: 0px; margin: 0px;">
                                        <tbody>
                                            <tr valign="top">
                                                <td><img alt="info" class="msgIcon" src="/s.gif"
                                                    title="info" /></td>
                                                <td class="messageCell"><div class="messageText">
                                                        <span><h4></h4>
                                                        </span>{!$Label.Information_Message_on_View_Page}<br />
                                                    </div></td>
                                            </tr>
                                            <tr>
                                                <td></td>
                                                <td></td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        <apex:actionFunction name="DateFileter" action="{!dateFilter}"
                            reRender="CustomDate" status="actStatusId"
                            oncomplete="validateDate(false); getHistoryRecordsForObject();disableDateFields(); hideDateFormat(); " />
                    
                    </div>
                </div>
            </div>
        </div>
    </apex:form>

    <script>
        var startDate;
        var endDate;
        var loaderId = '100000';
        var selectedObjLabel;
        var pdfCurrentPage = 0; 
        function setFocusOnLoad() {
        }
        $(document).ready(function() {
            $(".dateFormat").hide();
            $(".viewDataButton").hide();
            $(".NumberOfDay").hide();
            $( "body" ).on( "click", ".ui-dialog-titlebar-close", function( event ) {
              $("#dialog").dialog( "close" );
              $("body").css("overflow-y", "visible");
            });
            $('#dialog').hide();
            $(".hidden-element").removeClass("hidden-element");
            // $(".pagination").removeClass("hidden-element");
            selectedObj = '{!selectedObject}';
            startDate =  '{!startDate}';
            endDate = '{!endDate}';
            selectedObjLabel = $(".object option:selected").text();
        });
        $("body").on("click", ".scrollTable th .sort", function() {
            elemntId = $(this).attr("id");
            $(".scrollTable th .sort").each(function() {
                if (!($(this).attr("id") == elemntId))
                    $(this).removeClass("ascending descending");
            });
            if ($(this).hasClass("ascending")) {
                $(this).removeClass("ascending").addClass("descending");
            } else if ($(this).hasClass("descending")) {
                $(this).removeClass("descending").addClass("ascending");
            } else {
                $(this).addClass("ascending");
            }
        });
        var checkSort = function(elementId) {
            $(".scrollTable th .sort").each(function() {
                if (!($(this).attr("id") == elementId))
                    $(this).removeClass("ascending descending");
            });
        }
         function closeDialog(){
            $("#dialog").dialog( "close" );
            $("body").css("overflow-y", "visible");
        }
        var typewatch = function(){
            var timer = 0;
            return function(callback, ms){
                clearTimeout (timer);
                timer = setTimeout(callback, ms);
            }  
        }();
        function checkDayValue() {
            // $(".TxtDays").blur();
            if($(".TxtDays").val()==0){
                $("#DayError").html('Invalid Days');
                $(".FromToDate").hide();
                //angular.element(document.getElementById('displayHistoryRecord')).scope().showMoreData = false;
                $(".showMoreButton").hide();
            }
            else{
                 $("#DayError").html('');
                 $(".FromToDate").show();
                 $(".showMoreButton").show();
                DateFileter();
            }
        }
        
        function validateDate(flag) {
            console.log('Method call');
            var startDate = $('.startDate').val();
            var endDate = $('.endDate').val();
            var msgs1 = [];
            var msgs2 = [];
            var msgElement1 = $("#dateErrorMessageStartDateDiv");
            var msgElement2 = $("#dateErrorMessageEndDateDiv");
            msgElement1.html('');
            msgElement2.html('');
            if (startDate !== null && startDate !== ''
                    && !isValidDate(startDate)) {
                msgs1.push('Invalid Start Date');
            }
            if (endDate !== null && endDate !== '' && !isValidDate(endDate)) {
                msgs2.push('Invalid End Date');
            }
            if (startDate !== null && startDate !== '' && endDate !== null
                    && endDate !== '' && !msgs1.length
                    && !isValidRange(startDate, endDate)) {
                msgs1.push('Invalid Date Range');
            }
            if (msgs1.length) {
                var msgHtml = '';
                for (i = 0; i < msgs1.length; i++) {
                    msgHtml += msgs1[i] + '</br>';
                }
                $(".showMoreButton").hide();
                msgElement1.html(msgHtml);
            }
            if (msgs2.length) {
                var msgHtml = '';
                for (i = 0; i < msgs2.length; i++) {
                    msgHtml += msgs2[i] + '</br>';
                }
                msgElement2.html(msgHtml);
                $(".showMoreButton").hide();
            } else if (!msgs1.length && !msgs2.length) {
                if (flag == true) {
                    
                    DateFileter();
                    if ($(".dateRange option:selected").val != 'Custom') {
                        $(".dateRange option").each(function() {

                            if (this.value == 'Custom') {
                                this.selected = true;
                            }
                        });
                    }
                }
                $(".showMoreButton").show();
                $(".FromToDate").show();
            } else {
                $(".dateRange option").each(function() {
                    if (this.value == 'Custom') {
                        this.selected = true;
                    }
                });
            }
        }
        function isValidRange(startDate, endDate) {

            if (startDate > endDate) {
                return false;
            }
            return true;
        }
        function isValidDate(dateValue) {
            if(dateValue.length > 10) {
                return false;
            }
             return true;
        }
        var app = angular.module('myApp', ["ngSanitize"]);
        app.controller('fetchDataController', function($scope,$timeout) {
            $scope.CurrentDate = new Date().toLocaleString().split(',').join('');
            var inputForGetAttchmentService;
            var inputForGetRecordService;
            $scope.toUTCDate = toUTCDate;
            $scope.millisToUTCDate = millisToUTCDate;
            $scope.pageSize = '{!pageSize}';
            $scope.showLoader = false;
            $scope.showData;
            $scope.selecetdObject;
            $scope.loadMoreData = false;
            $scope.showMoreData = false;
            $scope.noSelectedObject = false;
            var i=0;
            $scope.reverse = true;
            $scope.recordLimit;
            $scope.previousSortField = '';
            var attachmentCount = 0;
            var offSet = 0;
            $scope.noOfPages = 0;
            $scope.currentPage = 0;
            $scope.currentPagepdf = 0;
            $scope.pageSizePdf = 10;
            var baseUrl = '{!salesforceBaseUrl}';
            $scope.fetchedHistoryData = [];
            $scope.filteredHistoryData = [];
            $scope.isDisplayFilter = false;
            $scope.displayAppliedFilterIconRecordName = false;
            $scope.displayAppliedFilterIconUserName = false;
            $scope.displayAppliedFilterIconFieldName = false;
            selectedObj = '{!selectedObject}';
            startDate =  '{!startDate}';
            endDate = '{!endDate}';
            $scope.myFieldFilter = {
                selected: {}
            };

            $scope.myRecordFilter = {
                selected: {}
            };

            $scope.myUserFilter = {
                selected: {}
            };
            
            $scope.getHtml = function(html){
                if(html != null && html != undefined && html != '' && html.indexOf("'") >= 0) {
                    return html.split("'").join("&quot;");
                }
                return html;
            };
            $scope.getRecords = function() {
                 offSet = 0;
                 $scope.reverse = true;
                 $scope.recordLimit = false;
                 $scope.showMoreData = false;
                 $scope.loadMoreData = false;
                 $scope.noSelectedObject = false;
                 $scope.fetchedHistoryData = [];
                 $scope.filteredHistoryData = [];
                 $scope.isDisplayFilter = false;
                 $scope.displayAppliedFilterIconRecordName = false;
                 $scope.displayAppliedFilterIconUserName = false;
                 $scope.displayAppliedFilterIconFieldName = false;
                if(selectedObj.length == 2) {
                    $scope.showLoader = true;
                    $scope.noSelectedObject = true;
                    $timeout(function(result) {
                       $scope.showLoader = false;
                    }, 100);

                }
                else {
                    $scope.getNumberofAttachment();
                }
            };
            
            $scope.downloadPdf = function() {
            var contentArray = [];
          
            var displayHeader = [{text: '{!$Label.VD_RecordName}', style: 'header'}, {text: '{!$Label.VD_Modified_on}', style: 'header'},
                                  {text: '{!$Label.VD_Modified_By}', style: 'header'},{text: '{!$Label.VD_Modified_Field}', style: 'header'},
                                  {text: '{!$Label.VD_Old_Value}', style: 'header'},{text: '{!$Label.VD_New_Value}', style: 'header'}
                                ]
            var headerArray = ['{!$Label.VD_JsonRecordName}','{!$Label.VD_JsonModifiedDisplayTime}','{!$Label.VD_JsonModifiedByName}','{!$Label.VD_JsonfieldLabel}','{!$Label.VD_JsonoldValue}','{!$Label.VD_JsonnewValue}'];
           
            angular.forEach($scope.filteredHistoryData , function(obj) {
                  var currentPage = 0;
                 var threshold = 11;
                 var rowArray = [];
                  for(var index=0;index<headerArray.length;index++){
                     var value = angular.equals(obj[headerArray[index]], null) ? '' : obj[headerArray[index]];
                     if(value.length > threshold) {
                       value = addSpacesContineousWord(value,threshold);
                      }
                       rowArray.push(value);
                 }
                 
                 contentArray.push(rowArray);
            });
            contentArray.unshift(displayHeader);
            var resultpdf = selectedObjLabel.substring(0, selectedObjLabel.indexOf('('));
            
            var docDefinition = {
            
            footer:function(currentPagepdf,pageSizePdf) {
                return {
                    columns : [                
                   {text: '{!$Label.Exported_by_Label}:'+ ' {!$User.FirstName} {!$User.LastName}' + ' {!$Label.VD_on} '+$scope.CurrentDate +', {!$Label.VD_powered_by}:' ,fontSize: 9,width: 'auto',margin: [ 40, 0, 2, 0 ]},
                   {image :imageDisplay(),width:20,height:9,margin: [ 0, 0, 0, 0 ]},
                   {text: '{!$Label.VD_company_name}',fontSize:9,width: 'auto',margin: [ -7, 0, 0, 0 ]},
                   {text: '{!$Label.VD_page}' + ' ' + currentPagepdf.toString()  + ' {!$Label.VD_Of} ' +  pageSizePdf , width: 'auto',margin: [ 36, 0,0, 0 ], fontSize: 9} 
                ]
               }
            
              },
                content: [
                 { text: ''+resultpdf +'{!$Label.VD_Title}', alignment: 'center',fontSize: 16,margin: [ 0, 0, 0, 10 ] },
                  {
                    table: {
                      headerRows: 1,
                      widths: ['16.5%', '16.5%', '16.5%','16.5%', '16.5%', '16.5%'],
                      body: contentArray
                    }
                  }
                ],
                 styles: {
                  header: {
                    color: 'black',
                    fillColor: '#a9a9a9',
                    fontSize : 11,
                    bold:true
                  }
                }
              };
            
              pdfMake.createPdf(docDefinition).download(''+resultpdf+' Historical Data.pdf');
             };
             function imageDisplay() {
                var c = document.getElementById("myCanvas");
                var ctx = c.getContext("2d");
                var img = document.getElementById("preview");
                ctx.drawImage(img, 30, 30);
                return c.toDataURL();
             }
             $scope.exportData = function () {
                var tempList = $scope.filteredHistoryData;
                var displayFooter = {recordName : '{!$Label.Exported_by_Label}:'+ ' {!$User.FirstName} {!$User.LastName}' +' {!$Label.VD_on} '+$scope.CurrentDate +', \n{!$Label.Powered_by_Label}',
                                       modifiedDisplayTime :'',
                                       fieldLabel :'',
                                       modifiedByName :'',
                                       oldValue  :'',
                                       newValue  :''
                                    };
                var insertBlank = {recordName : '',modifiedDisplayTime :'',fieldLabel :'',modifiedByName :'',oldValue  :'',newValue  :''};
                var insertBlankData = {recordName : '',modifiedDisplayTime :'',fieldLabel :'',modifiedByName :'',oldValue  :'',newValue  :''};
                tempList.push(insertBlank);
                tempList.push(insertBlankData);
                tempList.push(displayFooter);
                var result = selectedObjLabel.substring(0, selectedObjLabel.indexOf('('));
                alasql('SELECT recordName AS Name ,modifiedDisplayTime AS ModifiedTime , fieldLabel AS ModifiedField, modifiedByName AS ModifiedBy , oldValue AS OldValue ,newValue AS NewValue INTO CSV("'+result+' Historical Data.csv",{headers:true}) FROM ?',[tempList]);
                tempList.pop(displayFooter);
                tempList.pop(insertBlankData);  
                tempList.pop(insertBlank);
             };
            var toUTCDate = function(date) {

                var _utc = new Date(date.getUTCFullYear(), date.getUTCMonth(), 
                date.getUTCDate(),  date.getUTCHours(), date.getUTCMinutes(), date.getUTCSeconds());

                return _utc;
            };

            var millisToUTCDate = function(millis){
                return toUTCDate(new Date(millis));
            };

            $scope.numberOfPages = function() {
                return Math.ceil($scope.fetchedHistoryData.length/$scope.pageSize);
            }
            
            $scope.totalNumberOfRecordInPage = function() {
                 return ($scope.currentPage* $scope.pageSize) > ($scope.fetchedHistoryData.length) ? 
                        ($scope.fetchedHistoryData.length) : ($scope.currentPage*$scope.pageSize);
            }
            
            $scope.sort = function(keyname) {
                $scope.showLoader = true;
                var isAllColumnValueSame = true;
                for(var index = 1; index < $scope.filteredHistoryData.length; index++){
                        
                    if($scope.filteredHistoryData[index-1][keyname] 
                       !=  $scope.filteredHistoryData[index][keyname]){
                        isAllColumnValueSame = false;
                        break;                          
                    }                       
                }
                if(isAllColumnValueSame === true) {
                 $timeout(function() { 
                  $scope.showLoader = false;
                 
                  $scope.$apply();
                },100);
                    return;
                }
                
                $scope.sortKey = keyname;   //set the sortKey to the param passed
                if(angular.equals($scope.previousSortField, keyname))
                    $scope.reverse = !$scope.reverse;
                else 
                    $scope.reverse = false;
                $scope.previousSortField = keyname;
                
                
                
                 $timeout(function() { 
                  $scope.showLoader = false;
                 
                  $scope.$apply();
                },100);
            }
            
           // --------------Filters
          $scope.applyFilters = function() {
               
                $scope.showLoader = true;
                $scope.isDisplayFilter = true;
                $scope.loseFocus();
                $timeout(function(result) { 
                $scope.filteredHistoryData = [];
                var fieldArray = [];
                var recordArray = [];
                var userArray = [];
                var isPushedAlready;
                for(var index = 0; index < $scope.fetchedHistoryData.length; index++) {
                    var recordCount = 0;
                    isPushedAlready = false;
                    for(var property in $scope.myFieldFilter.selected) {
                        if($scope.myFieldFilter.selected[property]
                        && $scope.myFieldFilter.selected[property] === $scope.getHtml($scope.fetchedHistoryData[index].fieldName)) {
                            $scope.displayAppliedFilterIconFieldName = true;
                            fieldArray.push(index);
                        } else if( !$scope.myFieldFilter.selected[property] ) {
                            delete $scope.myFieldFilter.selected[property];
                        }
                    }
                    for(var property in $scope.myRecordFilter.selected) {
                        if($scope.myRecordFilter.selected[property]
                        && $scope.myRecordFilter.selected[property] === $scope.getHtml($scope.fetchedHistoryData[index].recordName)) {
                            recordArray.push(index);
                            $scope.displayAppliedFilterIconRecordName = true;
                        } else if( !$scope.myRecordFilter.selected[property] ) {
                            delete $scope.myRecordFilter.selected[property];
                        }
                    }
                    for(var property in $scope.myUserFilter.selected) {
                        if($scope.myUserFilter.selected[property]
                        && $scope.myUserFilter.selected[property] === $scope.getHtml($scope.fetchedHistoryData[index].modifiedByName)) {
                            userArray.push(index);
                            $scope.displayAppliedFilterIconUserName = true;
                        } else if( !$scope.myUserFilter.selected[property] ) {
                            delete $scope.myUserFilter.selected[property];
                        }
                    }
                }
                for(var index = 0; index < $scope.fetchedHistoryData.length; index++) {
                    if(((fieldArray.indexOf(index) >= 0) || (fieldArray.length === 0))
                    && ((recordArray.indexOf(index) >= 0) || (recordArray.length === 0))
                    && ((userArray.indexOf(index) >= 0) || (userArray.length === 0))) {
                        $scope.filteredHistoryData.push($scope.fetchedHistoryData[index]);
                    }
                }
                if(fieldArray.length === 0) {
                    $scope.displayAppliedFilterIconFieldName = false;
                }
                if(recordArray.length === 0) {
                     $scope.displayAppliedFilterIconRecordName = false;
                }
                if(userArray.length === 0) {
                     $scope.displayAppliedFilterIconUserName = false;
                }
                $scope.currentPage = 0;
                $scope.numberOfPages($scope.filteredHistoryData.length);
                $scope.showLoader = false;
              }, 100); 
            }
            $scope.numberOfPages = function(totalItemCount) {

                $scope.noOfPages = Math.ceil(totalItemCount/$scope.pageSize);
                if($scope.noOfPages <= $scope.currentPage) {
                    $scope.currentPage = $scope.noOfPages - 1;
                }
                if($scope.noOfPages === 0) {
                    $scope.currentPage = 0;
                }
            }
            $scope.clearFilter = function(filterName){
                $scope.showLoader = true;
                $scope.loseFocus();
                $timeout(function(result) {
                if(angular.equals(filterName, 'recordName')) {
                    $scope.myRecordFilter.selected = {};
                    $scope.applyFilters();
                    $scope.displayAppliedFilterIconRecordName = false;
                }
                else if(angular.equals(filterName, 'userName')) {
                    $scope.myUserFilter.selected = {};
                    $scope.applyFilters();
                    $scope.displayAppliedFilterIconUserName = false;

                }
                else if(angular.equals(filterName, 'fieldName')) {
                    $scope.myFieldFilter.selected = {};
                    $scope.applyFilters();
                    $scope.displayAppliedFilterIconFieldName = false;
                }
                else if(angular.equals(filterName, 'clearAllFilter')) {
                    $scope.myRecordFilter.selected = {};
                    $scope.myUserFilter.selected = {};
                    $scope.myFieldFilter.selected = {};
                    $scope.applyFilters();
                    $scope.numberOfPages($scope.filteredHistoryData.length);
                }
                if(angular.equals($scope.myFieldFilter.selected, {})
                && angular.equals($scope.myRecordFilter.selected, {})
                && angular.equals($scope.myUserFilter.selected, {})) {
                 $scope.isDisplayFilter = false;
                 $scope.displayAppliedFilterIconRecordName = false;
                 $scope.displayAppliedFilterIconUserName = false;
                 $scope.displayAppliedFilterIconFieldName = false;
                }
              }, 100);
               $scope.showLoader = false;
            };

            $scope.checkIfFiltersAppliedOrNot = function(){

                if(angular.equals($scope.myFieldFilter.selected, {})
                && angular.equals($scope.myRecordFilter.selected, {})
                && angular.equals($scope.myUserFilter.selected, {})) {
                    $scope.isDisplayFilter = false;
                }

                if(angular.equals($scope.isDisplayFilter, false)) {
                    return false;
                }
                return true;
            };

            $scope.loseFocus = function(){
                angular.element(document).find('body').triggerHandler('click');
                $('.dropdown-menu').off('click.stopPropagation');
                $('.dropdown-menu open').hide();
            };
            
            $scope.getNumberofAttachment = function() {
            
                $timeout(function(result) {
                    $scope.showLoader = true;
                }, 100);
                
                Visualforce.remoting.Manager.invokeAction(
                    '{!$RemoteAction.DataProviderForViewData.getAttachmentCount}',
                     selectedObj, 
                     startDate,
                     endDate,
                    function(result, event){
                        if (event.status) {
                           attachmentCount = result;
                           $scope.callLoadData();
                        }  
                        else {
                            $scope.showLoader = false;
                            $scope.$apply();
                        }
                    }, 
                       { buffer: false, escape: false, timeout: 30000 }
                );
            }
            $scope.getShowMoreData = function() {
                return ($scope.showMoreData);
            }
            $scope.callLoadData = function() {               
                $scope.fetchedHistoryData = [];
                $scope.filteredHistoryData = [];
                $scope.myRecordFilter.selected = {};
                $scope.myUserFilter.selected = {};
                $scope.myFieldFilter.selected = {};
                
                $scope.isDisplayFilter = false;
                $scope.displayAppliedFilterIconRecordName = false;
                $scope.displayAppliedFilterIconUserName = false;
                $scope.displayAppliedFilterIconFieldName = false;
                offSet = 0;
                if(attachmentCount > 0){                
                    for(i= 0; i < attachmentCount; i++) {
                        if(!$scope.showMoreData) {
                            $scope.loadData(i);
                        } 
                        else if($scope.loadMoreData && $scope.showMoreData){
                            if(!$scope.recordLimit) {
                                $scope.loadData(i);
                            }
                        }
                   }
                }
                else{
                    $scope.showLoader = false;
                    $scope.$apply();
                }
            }
            $scope.loadMoreDataForAnObject = function() {
                $scope.loadMoreData = true;
                $scope.callLoadData();
            }
            $scope.loadData = function(offSet1) {
                 $scope.showLoader = true;
                Visualforce.remoting.Manager.invokeAction(
                    '{!$RemoteAction.DataProviderForViewData.fetchAttachments}',
                     selectedObj, 
                     startDate,
                     endDate,
                     '{!viewUserFilterList}',
                     offSet1,
                    function(result, event){
                        if (event.status) {
                           if(result) {
                                angular.forEach(JSON.parse(result ), function (item) {
                                if(!$scope.showMoreData) {
                                    if($scope.fetchedHistoryData.length < 200){    
                                        item.newValue = replaceImageTagwithAnchor(item.newValue);
                                        item.oldValue = replaceImageTagwithAnchor(item.oldValue);
                                        $scope.fetchedHistoryData.push(item);
                                    }
                                    else {
                                        $scope.showMoreData = true;
                                    }
                               }   
                               else if($scope.showMoreData && $scope.loadMoreData) {
    
                                   if($scope.fetchedHistoryData.length < 50000) {
                                        item.newValue = replaceImageTagwithAnchor(item.newValue);
                                        item.oldValue = replaceImageTagwithAnchor(item.oldValue);
                                        $scope.fetchedHistoryData.push(item);           
                                   } 
                                   else {
                                        $scope.recordLimit = true;
                                  }
                              }
                            });
                             $scope.filteredHistoryData = $scope.fetchedHistoryData;
                             $scope.numberOfPages($scope.filteredHistoryData.length);
                         }
                         if(offSet == attachmentCount-1) {
                            if($scope.showMoreData && $scope.loadMoreData) {
                                $scope.showMoreData = false;
                            }
                            $scope.showLoader = false;
                            $scope.$apply();
                         }
                         ++ offSet;
                      }  
                        else {
                            $scope.showLoader = false;
                            $scope.$apply();
                        }
                    }, 
                    { buffer: false, escape: false, timeout: 30000 }
                );
            }
            $scope.paginationForAllButton = function(currentPageValue) {
                $scope.showLoader = true;
                $timeout(function(result) {
                    $scope.currentPage=currentPageValue;
                    $scope.showLoader = false;
                }, 2000);

            }
            $scope.getRecords();
        });
        app.filter('firstPage', function() {
            return function(input, start) {
                start = +start;
                return input.slice(start);
            }
        });
        app.filter('unique', function () {
            return function (items, filterOn) {
            if (filterOn === false) {
                return items;
            }

            if ((filterOn || angular.isUndefined(filterOn)) && angular.isArray(items)) {
                var hashCheck = {}, newItems = [];
                var extractValueToCompare = function (item) {
                    if (angular.isObject(item) && angular.isString(filterOn)) {
                        return item[filterOn];
                    } else {
                        return item;
                    }
                };

                angular.forEach(items, function (item) {
                    var valueToCheck, isDuplicate = false;
                    for (var i = 0; i < newItems.length; i++) {
                        if (angular.equals(extractValueToCompare(newItems[i]), extractValueToCompare(item))) {
                            isDuplicate = true;
                            break;
                        }
                    }
                    if (!isDuplicate) {
                        newItems.push(item);
                    }
                });
                items = newItems;
            }
            return items;
        };
    });
    function addSpacesContineousWord(value,threshold)  { 
         var strArray = [];
         if(value.length > threshold) {
             var start=0;
             var last=0;  
             if(value == null || value == undefined || value == '') {
                return;
             }
             var splitArray = value.split(' ');
             for(var index =0;index<splitArray.length;index++) {
                 if(splitArray[index].length>threshold) {
                     var start=0;
                     var last=0;    
                     while(start<splitArray[index].length) {
                         if((start+threshold)>splitArray[index].length)  {
                             last = splitArray[index].length;
                         } else {
                             last =start+threshold;
                         }  
                         strArray.push(splitArray[index].slice(start,last));
                         start+=threshold;  
                     }
                 }else{ 
                      strArray.push(splitArray[index]);
                 }
             } 
             value='';
             for(index=0;index<strArray.length;index++){   
                 strSlice = strArray[index];
                 value =value+strSlice+' ';
              }      
        }
        return value;
     }
    </script>
</apex:page>